# 6. 多様な投資アルゴリズム比較システム 要件定義 (v2.0)

## 6.1. 目的

AAVC戦略に限らず、様々な投資アルゴリズムを簡単に比較できる柔軟なシステムを構築する。
ユーザーはコマンドラインから使用したいアルゴリズムを指定し、複数の戦略を同時にバックテストして
パフォーマンスを比較できるようにする。

## 6.2. 主要機能

### 6.2.1. アルゴリズムプラグインシステム
- 新しい投資アルゴリズムを簡単に追加・削除できるプラグインシステムを導入済み。
- 既存のAAVC、DCA、Buy & Hold戦略はプラグインとして再構築済み。
- 新規アルゴリズムの動的ロード機能は今後の実装課題。
- ユーザー定義アルゴリズムのサポートは今後の検討課題。

### 6.2.2. 動的アルゴリズム選択
- `--algorithms` パラメータで使用するアルゴリズムを指定
- デフォルトではAAVC、DCA、Buy & Holdを実行
- カスタムアルゴリズムの組み合わせが可能

### 6.2.3. 拡張された比較機能
- 3つ以上のアルゴリズムの同時比較
- アルゴリズム別の詳細分析
- パフォーマンスランキング機能

## 6.3. システムアーキテクチャ

### 6.3.1. アルゴリズムレジストリ
- 利用可能なアルゴリズムの登録・管理
- アルゴリズムのメタデータ管理（名前、説明、パラメータ等）
- プラグインの動的ロード機能

### 6.3.2. アルゴリズムインターフェース
- 統一されたアルゴリズムインターフェース
- パラメータの標準化
- 結果の標準化

### 6.3.3. バックテストエンジン
- 複数アルゴリズムの並行実行
- 結果の統合・比較
- パフォーマンス分析

## 6.4. 利用可能なアルゴリズム

現在、以下のアルゴリズムが実装されており、`--algorithms` パラメータで指定可能です。

### 6.4.1. AAVC (Asymmetric Volatility-Adjusted Cost Average)
- 非対称ボラティリティ調整型ドルコスト平均法。
- 株価の下落時に投資額を増やし、上昇時に減らすことで、効率的な資産形成を目指します。

### 6.4.2. DCA (Dollar-Cost Averaging)
- ドルコスト平均法。
- 定期的に一定額を投資し、価格変動リスクを低減します。

### 6.4.3. Buy & Hold
- 買い持ち戦略。
- 一度購入した資産を長期にわたって保有し続けます。

### 6.4.4. 今後の実装予定アルゴリズム
- 改良版AAVC (Enhanced AAVC)
- 価格チャネル戦略 (Price Channel Strategy)
- ボラティリティ調整戦略 (Volatility Adjusted Strategy)
- セクターローテーション戦略 (Sector Rotation Strategy)
- セクター別パフォーマンス分析
- 強勢セクターへの投資集中
- 弱勢セクターからの撤退

## 6.5. CLIの拡張

### 6.5.1. 新規引数
- `--algorithms`: 使用するアルゴリズムの指定（カンマ区切り）
- `--algorithm-params`: アルゴリズム固有のパラメータ指定
- `--compare-mode`: 比較モードの指定（詳細/簡易）

### 6.5.2. 使用例
```bash
# デフォルトアルゴリズムでの比較
python -m src.AAVC_calculate_tool backtest \
  --ticker AAPL \
  --start-date 2023-01-01 \
  --end-date 2024-01-01 \
  --amount 10000

# カスタムアルゴリズムでの比較
python -m src.AAVC_calculate_tool backtest \
  --ticker AAPL \
  --start-date 2023-01-01 \
  --end-date 2024-01-01 \
  --amount 10000 \
  --algorithms "enhanced_aavc,price_channel,volatility_adjusted" \
  --plot

# アルゴリズム固有パラメータの指定
python -m src.AAVC_calculate_tool backtest \
  --ticker AAPL \
  --start-date 2023-01-01 \
  --end-date 2024-01-01 \
  --amount 10000 \
  --algorithms "enhanced_aavc" \
  --algorithm-params "enhanced_aavc:volatility_threshold=0.3,momentum_weight=0.5"
```

## 6.6. 出力形式の拡張

### 6.6.1. 拡張されたサマリーテーブル
- アルゴリズム数に応じた動的テーブル
- パフォーマンスランキング
- アルゴリズム別の詳細指標

### 6.6.2. 比較チャートの拡張
- 複数アルゴリズムの資産推移比較
- アルゴリズム別の色分け
- インタラクティブな凡例

### 6.6.3. 詳細分析レポート
- アルゴリズム別の詳細分析
- リスク・リターン分析
- 相関分析

## 6.7. 技術要件

### 6.7.1. 依存関係
- 既存の依存関係を維持
- 新規アルゴリズム用の追加ライブラリ（必要に応じて）

### 6.7.2. パフォーマンス要件
- 複数アルゴリズムの並行実行
- 大規模データセットでの効率的な処理
- メモリ使用量の最適化

### 6.7.3. 拡張性要件
- 新しいアルゴリズムの簡単な追加
- プラグインシステムの柔軟性
- 設定ファイルによるカスタマイズ

## 6.8. 移行計画

### 6.8.1. フェーズ1: 基盤構築
- アルゴリズムレジストリシステムの構築
- 既存アルゴリズムのプラグイン化
- 基本インターフェースの統一

### 6.8.2. フェーズ2: 新アルゴリズム追加
- 改良版AAVCの実装
- 価格チャネル戦略の実装
- ボラティリティ調整戦略の実装

### 6.8.3. フェーズ3: 高度な機能
- セクターローテーション戦略の実装
- 詳細分析レポートの実装
- パフォーマンス最適化

## 6.9. 後方互換性

- 既存のCLIコマンドは変更なしで動作
- 既存の設定ファイルとの互換性維持
- 既存のアルゴリズムの動作保証

## 6.10. エラーハンドリング

- 無効なアルゴリズム名の指定
- アルゴリズム固有パラメータの検証
- プラグインのロードエラー
- メモリ不足エラー
