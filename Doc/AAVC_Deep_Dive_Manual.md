# AAVCアルゴリズム 大解剖マニュアル

## 1. はじめに：AAVCとは何か？

AAVC（Asymmetric Volatility-Adjusted Cost Average：非対称ボラティリティ調整型ドルコスト平均法）は、従来のドルコスト平均法をさらに進化させた投資アルゴリズムです。

従来のドルコスト平均法が「常に一定額」を投資するのに対し、AAVCは**市場の状況（特に株価の変動）に応じて投資額を動的に調整する**ことを特徴とします。

### なぜAAVCなのか？

市場は常に変動しており、株価が下落した局面では「安く多く買う」ことが将来のリターンを最大化する上で重要になります。AAVCは、この「安く買う」機会を最大限に活かし、株価が上昇した局面では「高く少なく買う」ことで、効率的な資産形成を目指します。

## 2. AAVCを理解するための主要な概念

AAVCアルゴリズムを理解するために、いくつかの重要な用語と概念を把握しておく必要があります。

### 2.1. 基準投資額 (Base Investment Amount)

あなたが「もし株価が基準価格と同じだったら投資したい」と考える基本的な投資額です。例えば、毎月10,000円を投資したいと考えている場合、この10,000円が基準投資額となります。

### 2.2. 基準価格 (Reference Price)

投資額を調整する際の「基準」となる株価です。この基準価格と現在の株価との乖離によって、投資額が変動します。基準価格は、あなたが投資を開始した時点の株価や、特定の重要な価格帯など、任意に設定することができます。また、**移動平均を基準価格として動的に設定することも可能**です。

### 2.3. 移動平均期間 (Moving Average Period)

基準価格として移動平均を使用する場合に、その移動平均を計算する期間（日数）を指定します。例えば、200日移動平均を基準とする場合、この期間を200と設定します。移動平均は、市場のトレンドに適応した基準価格を提供し、固定された基準価格の限界を克服します。

*   **デフォルト値は200**です。
*   CLIの`calc`コマンドで`--ref-ma-period`オプション、または設定ファイル、`backtest`コマンドの`--algorithm-params`で指定可能です。

### 2.4. 現在価格 (Current Price)

投資判断を行う時点の、対象銘柄の実際の株価です。

### 2.4. 価格乖離率 (Price Deviation Ratio)

現在価格が基準価格からどれだけ離れているかを示す指標です。以下の式で計算されます。

`価格乖離率 = (現在価格 - 基準価格) / 基準価格`

*   価格乖離率が正（プラス）の場合：現在価格が基準価格より高い
*   価格乖離率が負（マイナス）の場合：現在価格が基準価格より低い

### 2.5. 非対称性係数 (Asymmetric Coefficient)

AAVCアルゴリズムの「非対称性」を決定する重要なパラメータです。この係数が大きいほど、株価が下落した際に投資額を増やす度合いが強くなります。逆に、株価が上昇した際の投資額の減少度合いも強くなります。

*   **デフォルト値は2.0**です。
*   **1.0**に設定すると、従来のドルコスト平均法に近い振る舞いになります（非対称性がなくなります）。
*   **3.0以上**に設定すると、より積極的に株価下落時に買い増しを行います。
*   CLIの`calc`コマンドで`--asymmetric-coefficient`オプション、または設定ファイル、`backtest`コマンドの`--algorithm-params`で指定可能です。

### 2.6. 最大投資額の基準額に対する倍率 (Max Investment Multiplier)

AAVCアルゴリズムによって算出される投資額には、上限が設定されています。このパラメータは、基準投資額に対して最大で何倍まで投資するかを制御します。これにより、極端な市場変動時でも投資額が過度に膨らむことを防ぎ、リスクを抑制します。

*   **デフォルト値は3.0**です。
*   例えば、基準投資額が10,000円の場合、デフォルトでは最大投資額は30,000円に制限されます。
*   CLIの`calc`コマンドで`--max-multiplier`オプション、または設定ファイル、`backtest`コマンドの`--algorithm-params`で指定可能です。

### 2.7. 計算投資額 (Calculated Investment Amount)

AAVCアルゴリズムによって最終的に算出される、実際に投資すべき金額です。この金額は、基準投資額、価格乖離率、非対称性係数、そして最大投資額の倍率に基づいて動的に決定されます。

## 3. AAVCアルゴリズムの核心：計算式

AAVCアルゴリズムの計算式は、以下の要素を組み合わせています。

`計算投資額 = 基準投資額 × (1 - 価格乖離率 × 非対称性係数)`

この式を分解して見ていきましょう。

### 3.1. 式の各要素の役割

*   **`基準投資額`**: 投資のベースとなる金額です。株価が基準価格と全く同じであれば、この金額がそのまま投資されます。

*   **`1 - (価格乖離率 × 非対称性係数)`**: この部分が、株価の変動に応じて投資額を調整する「調整係数」となります。
    *   **`価格乖離率`**: 現在価格が基準価格からどれだけ離れているかを示します。
    *   **`非対称性係数`**: 価格乖離率に掛け合わされることで、調整の度合い（特に下落時の積極性）をコントロールします。

### 3.2. 計算例で理解する

**前提条件:**
*   基準投資額 = 10,000 JPY
*   基準価格 = 100 JPY
*   非対称性係数 = 2.0 (デフォルト)

#### 例1：株価が下落した場合
*   現在価格 = 80 JPY (20%下落)
*   価格乖離率 = (80 - 100) / 100 = -0.2

`計算投資額 = 10,000 × (1 - (-0.2) × 2.0)`
`= 10,000 × (1 - (-0.4))`
`= 10,000 × (1 + 0.4)`
`= 10,000 × 1.4`
`= 14,000 JPY`

**結果:** 株価が20%下落したため、投資額は14,000 JPYに増加しました。これは、安くなった株をより多く買うというAAVCの目的を達成しています。

#### 例2：株価が上昇した場合
*   現在価格 = 120 JPY (20%上昇)
*   価格乖離率 = (120 - 100) / 100 = 0.2

`計算投資額 = 10,000 × (1 - 0.2 × 2.0)`
`= 10,000 × (1 - 0.4)`
`= 10,000 × 0.6`
`= 6,000 JPY`

**結果:** 株価が20%上昇したため、投資額は6,000 JPYに減少しました。これは、高くなった株を少なく買うというAAVCの目的を達成しています。

#### 例3：株価が基準価格と同じ場合
*   現在価格 = 100 JPY
*   価格乖離率 = (100 - 100) / 100 = 0

`計算投資額 = 10,000 × (1 - 0 × 2.0)`
`= 10,000 × (1 - 0)`
`= 10,000 × 1`
`= 10,000 JPY`

**結果:** 株価が基準価格と同じ場合、投資額は基準投資額と等しくなります。

## 4. AAVCの細かい振る舞いとシナリオ

### 4.1. 非対称性係数の影響

非対称性係数（`asymmetric_coefficient`）は、AAVCの「積極性」を調整するレバーです。

*   **`asymmetric_coefficient = 1.0` の場合:**
    *   `計算投資額 = 基準投資額 × (1 - 価格乖離率)`
    *   この場合、投資額の調整は価格乖離率に比例します。株価が20%下落すれば投資額は20%増加し、20%上昇すれば投資額は20%減少します。これは、従来のドルコスト平均法に「価格調整」の要素を加えた形に近くなりますが、AAVCの「非対称性」は弱まります。

*   **`asymmetric_coefficient = 2.0` (デフォルト) の場合:**
    *   上記計算例のように、価格乖離率の2倍の調整が行われます。株価下落時にはより積極的に買い増し、上昇時にはより積極的に買い控えを行います。

*   **`asymmetric_coefficient = 3.0` の場合:**
    *   `計算投資額 = 基準投資額 × (1 - 価格乖離率 × 3.0)`
    *   株価が20%下落した場合：`10,000 × (1 - (-0.2) × 3.0) = 10,000 × (1 + 0.6) = 16,000 JPY`
    *   株価が20%上昇した場合：`10,000 × (1 - 0.2 × 3.0) = 10,000 × (1 - 0.6) = 4,000 JPY`
    *   係数を大きくするほど、株価変動に対する投資額の調整がより極端になります。特に下落時の買い増し効果が顕著になります。

### 4.2. 株価の変動と投資額の関係

AAVCは、株価の変動に対して以下のような振る舞いをします。

*   **株価が基準価格より低い場合（下落局面）:**
    *   現在価格が基準価格から離れるほど（つまり、より安くなるほど）、`価格乖離率`はより大きな負の値になります。
    *   これにより、`価格乖離率 × 非対称性係数`はより大きな負の値となり、`1 - (負の値)`は1より大きな値になります。
    *   結果として、`計算投資額`は`基準投資額`よりも大きくなり、**安くなった株をより多く買う**ことになります。

*   **株価が基準価格より高い場合（上昇局面）:**
    *   現在価格が基準価格から離れるほど（つまり、より高くなるほど）、`価格乖離率`はより大きな正の値になります。
    *   これにより、`価格乖離率 × 非対称性係数`はより大きな正の値となり、`1 - (正の値)`は1より小さな値になります。
    *   結果として、`計算投資額`は`基準投資額`よりも小さくなり、**高くなった株を少なく買う**ことになります。

### 4.3. ボラティリティ（変動幅）の影響

AAVCの計算式には直接「ボラティリティ」という変数は含まれていませんが、ボラティリティが高い銘柄や市場では、株価の変動が大きくなるため、結果的にAAVCの調整機能がより頻繁かつ大きく発動することになります。

*   **高ボラティリティ環境:** 株価が大きく上下するため、AAVCは頻繁に投資額を大きく増減させます。これにより、下落時の買い増し機会をより多く捉え、上昇時の買い控えもより効果的に行われます。
*   **低ボラティリティ環境:** 株価の変動が小さいため、AAVCによる投資額の調整幅も小さく、基準投資額に近い金額が投資され続ける傾向にあります。

### 4.4. 極端なシナリオ

*   **株価がゼロに近づく場合:**
    *   価格乖離率が-1に近づくと、`計算投資額 = 基準投資額 × (1 - (-1) × 非対称性係数) = 基準投資額 × (1 + 非対称性係数)` となり、理論上は投資額が最大化されます。しかし、実際の投資額は「最大投資額の基準額に対する倍率」によって上限が設定されます。

*   **株価が非常に高騰する場合:**
    *   価格乖離率が非常に大きくなると、`価格乖離率 × 非対称性係数`も非常に大きくなり、`1 - (大きな正の値)`が負の値になる可能性があります。この場合、計算投資額も負の値になりますが、実際の投資では0円を下回ることはありません（投資しない、または売却するという判断になります）。ツールでは、計算投資額が0を下回る場合は0として扱われます。

## 5. 他の投資戦略との比較

### 5.1. ドルコスト平均法 (DCA) との比較

| 特徴           | ドルコスト平均法 (DCA) | AAVC (非対称ボラティリティ調整型) |
|:---------------|:-----------------------|:----------------------------------|
| 投資額の決定   | 常に一定額             | 株価の変動に応じて動的に調整      |
| 株価下落時     | 一定額でより多くの株を購入 | **より多くの金額を投資し、さらに多くの株を購入** |
| 株価上昇時     | 一定額でより少ない株を購入 | **より少ない金額を投資し、さらに少ない株を購入** |
| メリット       | シンプル、感情に左右されにくい | 下落時の買い増し効果が高い、効率的な資産形成 |
| デメリット     | 下落時の機会損失、上昇時の非効率性 | 計算が複雑、パラメータ設定の考慮が必要 |

### 5.2. バイ＆ホールド (Buy & Hold) との比較

| 特徴           | バイ＆ホールド (B&H) | AAVC (非対称ボラティリティ調整型) |
|:---------------|:---------------------|:----------------------------------|
| 投資タイミング | 一括投資または定期積立 | 株価の変動に応じて調整            |
| 投資額の決定   | 一定または一括       | 株価の変動に応じて動的に調整      |
| メリット       | シンプル、市場タイミング不要 | 下落時の買い増し効果が高い、効率的な資産形成 |
| デメリット     | 下落時の含み損が大きい | 計算が複雑、パラメータ設定の考慮が必要 |

AAVCは、DCAの「価格変動リスクの平準化」というメリットを享受しつつ、さらに「株価が安い時に多く買い、高い時に少なく買う」という積極的な調整を加えることで、より高いリターンを目指す戦略と言えます。

## 6. 実践的な考慮事項

### 6.1. 基準価格の設定

*   **投資開始時の価格:** 最もシンプルで分かりやすい方法です。
*   **移動平均線:** 長期的な移動平均線（例: 200日移動平均線）を基準価格とすることで、トレンドを考慮した調整が可能です。
*   **過去の安値/高値:** 特定の重要な価格帯を基準とすることも有効です。

### 6.2. 非対称性係数の選択

*   **リスク許容度:** 係数が大きいほど、下落時の買い増しが積極的になりますが、その分、市場の変動に対する投資額の変動も大きくなります。自身のリスク許容度に合わせて調整しましょう。
*   **市場環境:** ボラティリティが高い市場では、係数を大きくすることでAAVCのメリットを最大限に活かせる可能性があります。
*   **バックテスト:** 過去のデータで様々な係数を試すことで、最適な値を見つけることができます。

### 6.3. 限界とリスク

*   **極端な価格変動:** 株価が非常に大きく変動する場合、計算投資額が極端な値になる可能性があります（ツール側で0を下回らないように制御されます）。
*   **トレンド相場:** 強い上昇トレンドや下降トレンドが続く場合、AAVCの調整が常に同じ方向にかかり続けるため、DCAやバイ＆ホールドと比較してパフォーマンスが劣る可能性もあります。
*   **パラメータ依存:** 基準価格や非対称性係数の設定によってパフォーマンスが大きく左右されるため、適切なパラメータ選択が重要です。

## 7. まとめ

AAVCアルゴリズムは、従来のドルコスト平均法に「非対称な価格調整」という強力な要素を加えることで、市場の変動を味方につけ、より効率的な資産形成を目指すための洗練された戦略です。

株価が下落した際に積極的に買い増し、上昇した際には買い控えを行うことで、平均取得単価を効果的に引き下げ、長期的なリターンを最大化する可能性を秘めています。

本マニュアルが、AAVCアルゴリズムの深い理解の一助となれば幸いです。