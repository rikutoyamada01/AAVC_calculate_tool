# 機能要件定義書：機能7 - 月次投資額自動通知機能

**バージョン**: 1.0  
**作成日**: 2025年9月2日  
**作成者**: Gemini

---

## 1. 概要

本機能は、指定されたスケジュール（例：毎月1回）に基づき、AAVC（Asymmetric Average Volatility Cost）計算ツールを用いて特定の銘柄への投資推奨額を自動的に算出する。算出結果は、ユーザーが指定した通知先（Eメール等）へ送信される。

この機能の目的は、ユーザーが手動でツールを実行する手間を省き、PCがオフラインの状態であっても、定期的かつタイムリーに投資判断の一助となる情報を提供することにある。

## 2. スコープ

### 2.1. スコープ内

-   **自動実行**: GitHub Actions を利用し、定義されたスケジュールで自動的に処理を実行する。
-   **投資額算出**:
    -   プロジェクト内の `AAVC_calculate_tool.calculator` モジュールを再利用する。
    -   計算対象の銘柄（ティッカーシンボル）および基準投資額は、設定ファイルまたはスクリプト内に事前に定義された固定値を用いる。
-   **通知処理**:
    -   算出結果を含む通知メッセージを生成する。
    -   Eメールを介して、事前に定義された単一の宛先に通知を送信する。
-   **セキュリティ**:
    -   Eメールの認証情報（パスワード、APIキー等）は、GitHub Secrets を利用して安全に管理する。

### 2.2. スコープ外

-   **動的な設定変更**: ユーザーがWeb UI等を通じて、通知スケジュール、計算対象銘柄、通知先などを動的に変更する機能。
-   **複数宛先への通知**: 一度の実行で、複数の異なる宛先（例：複数のEメールアドレス）へ同時に通知する機能。
-   **高度なエラー処理**: 通知失敗時の自動リトライ処理など、GitHub Actions の標準機能を超える高度なエラーリカバリ機構。
-   **オンデマンド実行**: スケジュール実行とは別に、ユーザーの任意のタイミングで即時実行する機能。

## 3. 機能要件

| ID              | 要件名             | 詳細                                                                                                                                                           |
| :-------------- | :----------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **REQ-FN-7-001**  | スケジュール実行   | システムは、事前に定義されたスケジュール（特定の日時）で月次通知処理を自動的に開始しなければならない。<br>・実装にはGitHub Actionsの`schedule`トリガーを用いる。 |
| **REQ-FN-7-002**  | 投資額の算出       | システムは、`AAVC_calculate_tool.calculator`モジュールを利用して、指定された銘柄の投資推奨額を算出しなければならない。<br>・ティッカーと基準額は設定値（初期値: QQQ, $10,000）を用いる。 |
| **REQ-FN-7-003**  | 通知メッセージの生成 | システムは、算出結果を含んだ、人間が判読可能な形式の通知メッセージを生成しなければならない。<br>・メッセージ形式(例): `【月次投資額通知】QQQへの今月の投資推奨額は〇〇円です。` |
| **REQ-FN-7-004**  | Eメール通知        | システムは、生成した通知メッセージを、事前に定義されたEメールアドレス宛に送信しなければならない。<br>・標準的なSMTPプロトコルを利用するActionを用いる。         |

## 4. 非機能要件

| ID              | 要件名         | 詳細                                                                                                                            |
| :-------------- | :------------- | :------------------------------------------------------------------------------------------------------------------------------ |
| **REQ-NF-7-001**  | セキュリティ   | Eメールアカウントのパスワード等の機密情報は、ソースコード内に直接記述してはならず、GitHub Secretsに登録・管理されなければならない。 |
| **REQ-NF-7-002**  | コスト         | 本機能の実装および運用は、利用するサービスの無料利用枠の範囲内で完結しなければならない。<br>・GitHub Actionsの無料枠を前提とする。 |
| **REQ-NF-7-003**  | 保守性         | 自動化のために追加されるスクリプトおよびワークフロー定義ファイルは、他の開発者が容易に理解・修正できるよう、適切な構造とコメントを持つこと。 |

## 5. 前提条件と依存関係

-   本プロジェクトが、GitHub上のパブリックリポジトリとして管理されていること。
-   `requirements.txt` に、計算処理に必要な全てのPythonライブラリが定義されていること。
-   ユーザーが、通知の送信元として利用可能なEメールアカウント（例: Gmail）を保有しており、必要に応じてそのアカウントのアプリパスワード等を取得できること。

## 6. ユーザーシナリオ

**利用者**: AAVC投資戦略に関心のある個人投資家  
**シナリオ**:
「私は、毎月1日に、手動でPCを操作することなく、自動で『今月のQQQへの投資推奨額』をEメールで受け取りたい。これにより、投資戦略の実行を忘れず、タイムリーに行動の判断ができるようになる。」
