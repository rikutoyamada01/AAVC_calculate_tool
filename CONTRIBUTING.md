# コントリビューションガイド

このプロジェクトへの貢献に感謝します。開発を円滑に進めるため、以下のコーディング規約に従ってください。

## 1. コーディングスタイル

### 1.1. フォーマット
- コードフォーマッターとして **Black** を使用します。コミットする前に、必ず `black .` を実行してコードをフォーマットしてください。

### 1.2. リンティングと型チェック
- 静的解析ツールとして **Ruff** を使用し、一般的なコーディングエラーやスタイル違反をチェックします。
- 型チェッカーとして **Mypy** を使用します。型ヒントを可能な限り付与し、`mypy .` を実行して型エラーがないことを確認してください。

### 1.3. インポートの順序
- インポート文は **isort** を使って自動で整理します。以下の順序でグループ化してください。
  1. 標準ライブラリ
  2. サードパーティライブラリ
  3. ローカルアプリケーション（本プロジェクトのモジュール）

## 2. 命名規則
- **変数名、関数名**: `snake_case` (例: `calculated_amount`, `get_price_data`)
- **クラス名**: `PascalCase` (例: `DataProvider`, `InvestmentCalculator`)
- **定数名**: `UPPER_SNAKE_CASE` (例: `BASE_URL`, `DEFAULT_TIMEOUT`)

## 3. ドキュメンテーション

### 3.1. Docstring
- すべての公開モジュール、クラス、関数にはDocstringを記述してください。
- フォーマットは **Google Python Style Docstrings** に準拠します。

```python
def calculate_aavc_investment(price_path: list, base_amount: float) -> float:
    """AAVCアルゴリズムに基づいて投資額を計算します。

    Args:
        price_path (list): 過去の価格データのリスト。
        base_amount (float): 基準となる投資額。

    Returns:
        float: 計算された投資額。
    """
    # ... implementation ...
```

### 3.2. コメント
- 複雑なロジックや、一読して意図が分かりにくいコードには、その「なぜ」を説明するコメントを記述してください。
- 「何をしているか」を説明する自明なコメントは避けてください。

## 4. テスト

- 新しい機能を追加、またはバグを修正した場合は、必ずユニットテストを追加・更新してください。
- テストフレームワークとして **pytest** を使用します。

### 4.1. テストコードの配置と命名規則
- テストコードはプロジェクトルートの `tests/` ディレクトリに配置します。
- テストファイル名は `test_*.py` または `*_test.py` の形式とします。
- テスト関数/メソッド名は `test_` で開始します。

### 4.2. テストの種類
- **ユニットテスト**: 各モジュールや関数の単体機能を検証します。外部依存（API通信、ファイルI/Oなど）はモック化することを推奨します。
- **結合テスト**: 複数のモジュール間の連携や、システム全体のフローを検証します。

### 4.3. テストの実行
- プロジェクトルートで以下のコマンドを実行します。
  ```bash
  pytest
  ```
- コードカバレッジを測定するには、`pytest-cov`プラグインを使用します。
  ```bash
  pytest --cov=src
  ```

### 4.4. モックとスタブ
- 外部サービス（例: `yfinance`）やファイルシステムなど、テストの実行を不安定にする可能性のある依存関係は、`unittest.mock`ライブラリなどを用いてモック化することを推奨します。

## 5. コミットメッセージ
- コミットメッセージは、変更内容が明確にわかるように記述してください。
- プレフィックスを付けることを推奨します。（例: `feat:`, `fix:`, `docs:`, `style:`, `refactor:`, `test:`）
  - `feat: バックテスト機能を追加`
  - `fix: 基準価格が0の場合の計算エラーを修正`
  - `docs: READMEのCLI仕様を更新`

---
これらのツール (`Black`, `Ruff`, `Mypy`, `isort`) は、`pyproject.toml`で管理することを推奨します。